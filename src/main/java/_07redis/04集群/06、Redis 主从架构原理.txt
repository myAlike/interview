6、Redis 主从架构原理

单机的 redis，能够承载的 QPS 大概就在上万到几万不等。对于缓存来说，一般都是用来支撑读高并发的。因此架构做成主从(master-slave)架构，一主多从，主负责写，并且将数据复制到其它的 slave 节点，从节点负责读。所有的读请求全部走从节点。这样也可以很轻松实现水平扩容，支撑读高并发。

过程原理

（1）当从库和主库建立MS关系后，会向主数据库发送SYNC命令

（2）主库接收到SYNC命令后会开始在后台保存快照(RDB持久化过程)，并将期间接收到的写命令缓存起来

（3）当快照完成后，主Redis会将快照文件和所有缓存的写命令发送给从Redis

（4）从Redis接收到后，会载入快照文件并且执行收到的缓存的命令

（5）之后，主Redis每当接收到写命令时就会将命令发送从Redis，从而保证数据的一致